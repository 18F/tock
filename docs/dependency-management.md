# Dependency management

[:arrow_left: Back to Tock Documentation](../docs)

## Python

Tock uses [Pipenv] to manage development and production dependencies.
In both development and continuous integration, the Python environment is
established with `pipenv install --dev`.

With pipenv installed locally, you can update development and production dependencies with the following:

```sh
pipenv update --dev
```

Within the `application` docker container, the approach is slightly different due to the volumes and working_dir set in `docker-compose.yml`.

```sh
docker-compose run application bash
$ pipenv update --dev
$ cp ../Pipfile.lock ./Pipfile.lock
# Exit docker container
cp ./tock/Pipfile.lock ./Pipfile.lock
rm ./tock/Pipfile.lock
```

Either approach will result in an updated `Pipfile.lock` file located in your local copy of the codebase, ready for commit and submission of a pull request.

### Updating Python

The Python version used in production is specified in `runtime.txt`. When updating the codebase to a new version of Python:

1. Update the `runtime.txt` to ensure the correct version is used in production
2. Update the `FROM` line in the `Dockerfile` to ensure the version used in development matches production
3. Update the `python_version` line in `Pipfile` to ensure dependencies for the correct Python version are used
4. Update `.circleci/config.yml` to ensure the correct Python version is used in CI

## USWDS
The uswds is initially installed via `npm` and then is compiled via gulp using the [uswds-gulp](https://github.com/uswds/uswds) configuration. To update USWDS, update the 2.x version in the `package.json` and review the release notes to identify any breaking changes.

## JavaScript

### Production

Tock uses Django's staticfiles functionality to serve frontend dependencies in production.

Other than the uswds, updates for dependencies must be committed directly to this repository in `tock/tock/static`.

### Development/Testing
Tock uses [npm] to manage development/testing JavaScript dependencies.

Update dependencies locally with the following:

```sh
npm update
```

## Preserving dependency artifacts

All files generated by updating dependencies, including but not limited to the
following files, should be committed to the repository. These files should be
treated as binary files so that they aren't diffed by Git. Add any files meeting this
description to the `.gitattributes` file at the root of the repository with the
`binary` flag.

- `package-lock.json`
- `Pipfile.lock`

[Pipenv]: https://docs.pipenv.org/
[npm]: https://www.npmjs.com
